<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Δ = THE OBSERVER + Solar Flare</title>
  <style>
    body {background:#000;color:#fff;font-family:sans-serif;text-align:center;padding:50px;}
    h1 {font-size:2em;margin-bottom:10px;}
    p {font-size:1.2em;margin:8px 0;}
    button {background:#00f;color:#fff;padding:12px 24px;border:none;border-radius:8px;cursor:pointer;font-size:1.1em;margin:10px 5px;}
    button:disabled {background:#333;cursor:not-allowed;opacity:0.6;}
    button.flare {background:#b00;}
    #progress {width:250px;height:12px;background:#333;margin:20px auto;border-radius:6px;overflow:hidden;}
    #result {margin-top:20px;white-space:pre-wrap;font-family:monospace;font-size:1.1em;line-height:1.6;}
    .pulse {animation:pulse 1.5s infinite;color:#0f0;text-shadow:0 0 10px #0f0;}
    .pulse-red {animation:pulse-red 1.2s infinite;color:#f55;text-shadow:0 0 12px #f55;}
    @keyframes pulse {0%{opacity:1}50%{opacity:0.5}100%{opacity:1}}
    @keyframes pulse-red {0%{opacity:1}50%{opacity:0.3}100%{opacity:1}}
    #noise-slider {width:250px;margin:20px auto;}
    #noise-value {display:block;margin-top:8px;font-family:monospace;color:#0f0;}
    #flare-status {margin:15px 0;font-family:monospace;color:#ff0;}
    #pyodide-loading {margin:15px;color:#0f0;font-family:monospace;display:none;}
    canvas {background:#111;margin:15px auto;display:block;border:1px solid #333;}
  </style>
</head>
<body>
  <h1>Δ = THE OBSERVER</h1>
  <p>Live Bell-State CHSH simulation in a noisy cavity.</p>
  <p>Slide noise, then click to collapse the wavefunction.</p>

  <div>Noise Level (γ): <span id="noise-value">0.005</span></div>
  <input type="range" id="noise-slider" min="0" max="0.1" step="0.001" value="0.005">

  <div id="progress"></div>
  <button id="collapse">Collapse Now</button>
  <button id="predict-flare">Predict Flare</button>

  <div id="pyodide-loading">Loading quantum engine (Pyodide)… please wait</div>
  <div id="flare-status"></div>
  <canvas id="flux-chart" width="400" height="120"></canvas>

  <div id="result"></div>

  <!-- Pyodide -->
  <script src="https://cdn.jsdelivr.net/pyodide/v0.26.1/full/pyodide.js"></script>
  <script>
    /* -------------------------------------------------
       1. Pyodide initialization with loading indicator
       ------------------------------------------------- */
    async function initPyodide() {
      const loadingEl = document.getElementById('pyodide-loading');
      loadingEl.style.display = 'block';
      let py = await loadPyodide();
      await py.loadPackage("numpy");
      loadingEl.style.display = 'none';
      return py;
    }
    const pyReady = initPyodide();

    /* -------------------------------------------------
       2. UI Elements
       ------------------------------------------------- */
    const slider = document.getElementById('noise-slider');
    const noiseVal = document.getElementById('noise-value');
    const collapseBtn = document.getElementById('collapse');
    const predictBtn = document.getElementById('predict-flare');
    const resultDiv = document.getElementById('result');
    const flareDiv = document.getElementById('flare-status');
    const canvas = document.getElementById('flux-chart');
    const ctx = canvas.getContext('2d');
    const prog = document.getElementById('progress');

    slider.addEventListener('input', () => noiseVal.textContent = slider.value);

    /* -------------------------------------------------
       3. CHSH Simulation (with Pyodide guard)
       ------------------------------------------------- */
    collapseBtn.addEventListener('click', async
